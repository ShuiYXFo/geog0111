



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Prof P. Lewis">
      
      <link rel="shortcut icon" href="../images/ucl.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Weighted Interpolation - GEOG0111</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d3202873.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#043-weighted-interpolation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="GEOG0111" class="md-header-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            GEOG0111
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Weighted Interpolation
            
          </span>
        </div>
      
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/UCL-EO/geog0111/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GEOG0111" class="md-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    GEOG0111
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/UCL-EO/geog0111/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Course Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Course Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Course Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use/" title="Notebook Use" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix/" title="Unix" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help/" title="Help" class="md-nav__link">
      Help
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../004_Accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../005_Packages/" title="Packages" class="md-nav__link">
      Packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use_answers/" title="Notebook Use" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix_answers/" title="Unix" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help_answers/" title="Help" class="md-nav__link">
      Help
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Core Concepts
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Core Concepts" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Core Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../010_Python_Introduction/" title="Python Introduction" class="md-nav__link">
      Python Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../011_Python_data_types/" title="Python Data Types" class="md-nav__link">
      Python Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../012_Python_strings/" title="Python Strings" class="md-nav__link">
      Python Strings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../013_Python_string_methods/" title="Python String Methods" class="md-nav__link">
      Python String Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../014_Python_groups/" title="Python Groups" class="md-nav__link">
      Python Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../015_Python_control/" title="Python Control" class="md-nav__link">
      Python Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../016_Python_for/" title="Python For" class="md-nav__link">
      Python For
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../017_Functions/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../018_Running_Python/" title="Running Python" class="md-nav__link">
      Running Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-10" type="checkbox" id="nav-3-10">
    
    <label class="md-nav__link" for="nav-3-10">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-3-10">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../010_Python_Introduction_answers/" title="Python Introduction" class="md-nav__link">
      Python Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../011_Python_data_types_answers/" title="Python Data Types" class="md-nav__link">
      Python Data Types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../012_Python_strings_answers/" title="Python Strings" class="md-nav__link">
      Python Strings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../013_Python_string_methods_answers/" title="Python String Methods" class="md-nav__link">
      Python String Methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../014_Python_groups_answers/" title="Python Groups" class="md-nav__link">
      Python Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../015_Python_control_answers/" title="Python Control" class="md-nav__link">
      Python Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../016_Python_for_answers/" title="Python For" class="md-nav__link">
      Python For
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../017_Functions_answers/" title="Functions" class="md-nav__link">
      Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../018_Running_Python_answers/" title="Running Python" class="md-nav__link">
      Running Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Data Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Data Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Data Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../020_Python_files/" title="Python Files" class="md-nav__link">
      Python Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../021_Streams/" title="Streams" class="md-nav__link">
      Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../022_Read_write_files/" title="Read Write Files" class="md-nav__link">
      Read Write Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../023_Plotting/" title="Plotting" class="md-nav__link">
      Plotting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../024_Image_display/" title="Image Display" class="md-nav__link">
      Image Display
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../020_Python_files_answers/" title="Python Files" class="md-nav__link">
      Python Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../021_Streams_answers/" title="Streams" class="md-nav__link">
      Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../022_Read_write_files_answers/" title="Read Write Files" class="md-nav__link">
      Read Write Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../023_Plotting_answers/" title="Plotting" class="md-nav__link">
      Plotting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../024_Image_display_answers/" title="Image Display" class="md-nav__link">
      Image Display
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Array Data
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Array Data" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Array Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../030_NASA_MODIS_Earthdata/" title="NASA MODIS Earthdata" class="md-nav__link">
      NASA MODIS Earthdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../031_Numpy/" title="Numpy" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../032_More_numpy/" title="More Numpy" class="md-nav__link">
      More Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../030_NASA_MODIS_Earthdata_answers/" title="NASA MODIS Earthdata" class="md-nav__link">
      NASA MODIS Earthdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../031_Numpy_answers/" title="Numpy" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../032_More_numpy_answers/" title="More Numpy" class="md-nav__link">
      More Numpy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Geospatial Data
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Geospatial Data" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Geospatial Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../040_GDAL_mosaicing_and_masking/" title="GDAL Mosaicing And Masking" class="md-nav__link">
      GDAL Mosaicing And Masking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../041_GDAL_timeseries/" title="GDAL Timeseries" class="md-nav__link">
      GDAL Timeseries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../042_Weighted_smoothing_and_interpolation/" title="Weighted Smoothing And Interpolation" class="md-nav__link">
      Weighted Smoothing And Interpolation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Weighted Interpolation
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Weighted Interpolation" class="md-nav__link md-nav__link--active">
      Weighted Interpolation
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smoothing" class="md-nav__link">
    Smoothing
  </a>
  
    <nav class="md-nav" aria-label="Smoothing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smoothing_1" class="md-nav__link">
    Smoothing
  </a>
  
    <nav class="md-nav" aria-label="Smoothing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-mask" class="md-nav__link">
    data mask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#land-cover" class="md-nav__link">
    Land cover
  </a>
  
    <nav class="md-nav" aria-label="Land cover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    Exercise 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formative-assessment" class="md-nav__link">
    Formative assessment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../040_GDAL_mosaicing_and_masking_answers/" title="GDAL Mosaicing And Masking" class="md-nav__link">
      GDAL Mosaicing And Masking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../041_GDAL_timeseries_answers/" title="GDAL Timeseries" class="md-nav__link">
      GDAL Timeseries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../043_Weighted_interpolation_answers/" title="Weighted Interpolation" class="md-nav__link">
      Weighted Interpolation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Modelling
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Modelling" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../050_Models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../051_Phenology_model/" title="Phenology Model" class="md-nav__link">
      Phenology Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../050_Models_answers/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../051_Phenology_model_answers/" title="Phenology Model" class="md-nav__link">
      Phenology Model
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Assessment
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Assessment" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Assessment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../060_Groups/" title="Groups" class="md-nav__link">
      Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../061_Script/" title="Script" class="md-nav__link">
      Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../062_Part1/" title="Part1" class="md-nav__link">
      Part1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../063_Part1_code/" title="Part1 Code" class="md-nav__link">
      Part1 Code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../064_Numpy/" title="Numpy" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../065_LAI/" title="Lai" class="md-nav__link">
      Lai
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../066_Part2/" title="Part2" class="md-nav__link">
      Part2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-8" type="checkbox" id="nav-8-8">
    
    <label class="md-nav__link" for="nav-8-8">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-8-8">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../060_Groups_answers/" title="Groups" class="md-nav__link">
      Groups
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../061_Script_answers/" title="Script" class="md-nav__link">
      Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../064_Numpy_answers/" title="Numpy" class="md-nav__link">
      Numpy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../065_LAI_answers/" title="Lai" class="md-nav__link">
      Lai
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Summary
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Summary" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        Summary
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../070_Summary/" title="Summary" class="md-nav__link">
      Summary
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    Test
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#smoothing" class="md-nav__link">
    Smoothing
  </a>
  
    <nav class="md-nav" aria-label="Smoothing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smoothing_1" class="md-nav__link">
    Smoothing
  </a>
  
    <nav class="md-nav" aria-label="Smoothing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-mask" class="md-nav__link">
    data mask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#land-cover" class="md-nav__link">
    Land cover
  </a>
  
    <nav class="md-nav" aria-label="Land cover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    Exercise 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#formative-assessment" class="md-nav__link">
    Formative assessment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/043_Weighted_interpolation.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="043-weighted-interpolation">043 Weighted interpolation</h1>
<h2 id="introduction">Introduction</h2>
<h3 id="purpose">Purpose</h3>
<p>We have seen in <a href="../042_Weighted_smoothing_and_interpolation/">042_Weighted_smoothing_and_interpolation</a> how we can regularise a dataset using colvolution filtering. We investigate and apply that now to allow us to provide gap-filled datasets.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>You must make sure you can recall the details of the work covered in <a href="../040_GDAL_mosaicing_and_masking/">040_GDAL_mosaicing_and_masking</a> and understand the material in <a href="../042_Weighted_smoothing_and_interpolation/">042_Weighted_smoothing_and_interpolation</a>. You will also need to know how to do <a href="../023_Plotting/">graph plotting</a>, including sub-figures and errorbars, and <a href="../024_Image_display/">image display</a>.</p>
<h3 id="test">Test</h3>
<p>You should run a <a href="../004_Accounts/">NASA account test</a> if you have not already done so.</p>
<h2 id="smoothing">Smoothing</h2>
<p>In convolution, we combine a <em>signal</em> $y$ with a <em>filter</em> $f$ to achieve a filtered signal. For example, if we have an noisy signal, we will attempt to reduce the influence of high frequency information in the signal (a 'low pass' filter, as we let the low frequency information <em>pass</em>).</p>
<p>We can perform a weighted interpolation by:</p>
<ul>
<li>numerator   = smooth( signal $\times$ weight)</li>
<li>denominator = smooth( weight)</li>
<li>result = numerator/denominator</li>
</ul>
<p>We will now load up a dataset (LAI for LU for 2019) to explore smoothing. We will use the function <a href="../geog0111/get_lai_data.py">get_lai_data</a> that we have previously developed:</p>
<pre><code class="python">from geog0111.get_lai_data import get_lai_data
import numpy as np

# load some data
tile    = ['h17v03','h18v03','h17v04','h18v04']
year    = 2019
fips    = &quot;LU&quot;

lai,std,doy =  get_lai_data(year,tile,fips)

# sort the weight as in the exercio
std[std&lt;1] = 1
weight = np.zeros_like(std)
mask = (std &gt; 0)
weight[mask] = 1./(std[mask]**2)
weight[lai &gt; 10] = 0.
</code></pre>

<h4 id="exercise-1">Exercise 1</h4>
<ul>
<li>Write a function <code>get_weight</code> that takes as argument:<pre><code>lai  : MODIS LAI dataset
std  : MODIS LAI uncertainty dataset
</code></pre>
</li>
</ul>
<p>and returns an array the same shape as lai/std of per-pixel pixel weights
* Read a MODIS LAI dataset, calculate the weights, and print some statistics of the weights</p>
<p>We can plot the dataset for a given pixel (<code>(107,72)</code> here) to see some of the features of the data:</p>
<pre><code class="python">import matplotlib.pyplot as plt

# look at some stats
print(weight.min(),weight.max(),doy.min(),doy.max())
error = np.zeros_like(weight)
error[weight&gt;0] = np.sqrt(1./(weight[weight&gt;0] )) * 1.97

p0,p1 = (107,72)
x_size,y_size=(10,5)

shape=(10,10)
fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy

axs.errorbar(x,lai[:,p0,p1],yerr=error[:,p0,p1]/10)
axs.set_title(f'{p0} {p1}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
</code></pre>

<pre><code>0.0 1.0 1 365





Text(0, 0.5, 'LAI')
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_6_2.png" /></p>
<p>The LAI data, that we expect to be smoothly varying in time, has unrealistic high frequency variations (it goes up and down too much). It also has data missing for some days (e.g. when too cloudy), and is often, in the winter, highly uncertain.</p>
<p>Despite that, we can 'see' that there should be a smoothly varying function that can go through those data points quite well. This is what we want to achieve with our regularisation.</p>
<h3 id="smoothing_1">Smoothing</h3>
<p>We can generate a Gaussian filter for our smoothing. The width of the filter, that in turn controls the degree of smoothing, is set by the parameter <code>sigma</code>. Recall the impact of the filter width from the <a href="../042_Weighted_smoothing_and_interpolation/#Filter-width-and-degree-of-smoothing">material in the previous session</a>. We will use a value of <code>5</code> here, but you should <em>not</em> assume that that will always be appropriate. We will discuss how to experiment with this later in this session.</p>
<pre><code class="python">import scipy
import scipy.ndimage.filters

# sigma controls the width of the smoother
sigma = 5

x = np.arange(-3*sigma,3*sigma+1)
gaussian = np.exp((-(x/sigma)**2)/2.0)

plt.plot(x,gaussian)
</code></pre>

<pre><code>[&lt;matplotlib.lines.Line2D at 0x7fba6be4e7d0&gt;]
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_8_1.png" /></p>
<p>We now perform the weighted regularisation by convolution.</p>
<pre><code class="python">numerator = scipy.ndimage.filters.convolve1d(lai * weight, gaussian, axis=0,mode='wrap')
denominator = scipy.ndimage.filters.convolve1d(weight, gaussian, axis=0,mode='wrap')

# avoid divide by 0 problems by setting zero values
# of the denominator to not a number (NaN)
denominator[denominator==0] = np.nan

interpolated_lai = numerator/denominator
</code></pre>

<p>We can plot the results in various ways:</p>
<pre><code class="python">p0,p1 = (107,72)
x_size,y_size=(10,5)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,interpolated_lai[:,p0,p1],'r--',label='smoothed LAI')
axs.plot(x,lai[:,p0,p1],'+',label='LAI')
axs.plot(x,weight[:,p0,p1],'+',label='weight')

axs.set_title(f'{p0} {p1}')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_xlabel('DOY 2019')
axs.set_ylabel('LAI')
axs.legend(loc='best')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7fba639eaf90&gt;
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_12_1.png" /></p>
<pre><code class="python"># Plot the interpolated_lai
import matplotlib.pyplot as plt

shape=(12,8)
x_size,y_size=(20,30)

fig, axs = plt.subplots(*shape,figsize=(x_size,y_size))
axs = axs.flatten()
plt.setp(axs, xticks=[], yticks=[])

for i in range(interpolated_lai.shape[0]):
    im = axs[i].imshow(interpolated_lai[i],vmax=7,cmap=plt.cm.inferno_r,\
                       interpolation='nearest')
    axs[i].set_title(doy[i])
    fig.colorbar(im, ax=axs[i])
</code></pre>

<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_13_0.png" /></p>
<pre><code class="python">import matplotlib.pyplot as plt

x_size,y_size=(20,20)

shape=(10,10)
fig, axs = plt.subplots(*shape,figsize=(x_size,y_size))
plt.setp(axs, xticks=[], yticks=[])

pixel = (100,70)
x = doy

for i in range(shape[0]):
    p0 = pixel[0] + i
    for j in range(shape[1]):
        p1 = pixel[1] + j
        axs[i,j].plot(x,interpolated_lai[:,p0,p1])
        axs[i,j].plot(x,lai[:,p0,p1],'+')
        axs[i,j].set_title(f'{p0} {p1}')
        # ensure the same scale for all
        axs[i,j].set_ylim(0,7)
</code></pre>

<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_14_0.png" /></p>
<p>This achieves very plausible results for this dataset. The time series plots are particularly useful in judging this: we see that the smoothed signal describes the cloud of observations well. Further, there are no gaps in the data. A visual assessment of this kind is a useful tool for deciding if we are on the right track with our regularisation. We have not justified the filter width value we have used though.</p>
<h4 id="exercise-2">Exercise 2</h4>
<ul>
<li>Write a function <code>regularise</code> that takes as argument:<pre><code>lai     : MODIS LAI dataset
weight  : MODIS LAI weight
sigma   : Gaussian filter width
</code></pre>
</li>
</ul>
<p>and returns an array the same shape as lai of regularised LAI
* Read a MODIS LAI dataset and regularise it
* Plot original LAI, and regularised LAI for varying values of sigma, for one pixel</p>
<p>Hint: You will find such a function useful when completing Part B of the assessed practical, so it is well worth your while doing this exercise.</p>
<h2 id="data-mask">data mask</h2>
<p>Although these datasets look complete when we plot them, it is still possible that some pixels have no valid data points or invalid pixels. Earlier, we set </p>
<pre><code>    denominator[denominator==0] = np.nan
</code></pre>
<p>so we would expect invalid pixels to contain <code>np.nan</code>. We can build a mask for these pixels, for example by summing along the time axis (axis 0):</p>
<pre><code>    mask = np.sum(interpolated_lai,axis=0)
</code></pre>
<p>This will build a 2D dataset that is <code>np.nan</code> if invalid. We can then use <code>~np.isnan</code> to build a boolean mask. The <code>~</code> symbol is the same as doing <code>np.logical_not()</code> in this context. It will be <code>True</code> where invalid, and <code>False</code> where valid:</p>
<pre><code class="python"># reload the dataset
from geog0111.get_lai_data import get_lai_data
from geog0111.get_weight import get_weight
from geog0111.regularise import regularise

lai,std,doy =  get_lai_data(year,tile,fips)
weight = get_weight(lai,std)
interpolated_lai = regularise(lai,weight,5.0)
</code></pre>

<pre><code class="python">mask = ~np.isnan(np.sum(interpolated_lai,axis=0))

x_size,y_size=(10,10)
fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.imshow(mask)
axs.set_title('data mask')
</code></pre>

<pre><code>Text(0.5, 1.0, 'data mask')
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_19_1.png" /></p>
<h2 id="land-cover">Land cover</h2>
<p>We have generated a gap-filled LAI dataset, and have checked the quality of it. Lets now load some land cover data so that we can examine LAI as a function of land cover class:</p>
<p>We will use <code>LC_Type3</code> as this is the classification associated with the LAI product. You will find a CSV file defining the LC types in <a href="../data/LC_Type3_colour.csv"><code>data/LC_Type3_colour.csv</code></a>.</p>
<pre><code class="python">from geog0111.modis import Modis

# LU
kwargs = {
    'tile'      :    ['h17v03', 'h18v03','h17v04', 'h18v04'],
    'product'   :    'MCD12Q1',
}

year  = 2019
doy = 1
# get the data
modis = Modis(**kwargs)

warp_args = {
    'dstNodata'     : 255,
    'format'        : 'MEM',
    'cropToCutline' : True,
    'cutlineWhere'  : &quot;FIPS='LU'&quot;,
    'cutlineDSName' : 'data/TM_WORLD_BORDERS-0.3.shp'
}

# specify day of year (DOY) and year
lcfiles = modis.get_modis(year,doy,warp_args=warp_args)
lcfiles.keys()
</code></pre>

<pre><code>dict_keys(['LC_Prop1', 'LC_Prop1_Assessment', 'LC_Prop2', 'LC_Prop2_Assessment', 'LC_Prop3', 'LC_Prop3_Assessment', 'LC_Type1', 'LC_Type2', 'LC_Type3', 'LC_Type4', 'LC_Type5', 'LW', 'QC', 'bandnames'])
</code></pre>
<pre><code class="python">import pandas as pd
# read the colour data
lc_Type3 = pd.read_csv('data/LC_Type3_colour.csv')
lc_Type3
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>colour</th>
      <th>class</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>#1c0dff</td>
      <td>Water Bodies</td>
      <td>at least 60% of area is covered by permanent w...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>#b6ff05</td>
      <td>Grasslands</td>
      <td>dominated by herbaceous annuals (&lt;2m) includin...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>#dcd159</td>
      <td>Shrublands</td>
      <td>shrub (1-2m) cover &gt;10%.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>#c24f44</td>
      <td>Broadleaf</td>
      <td>Croplands: bominated by herbaceous annuals (&lt;2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>#fbff13</td>
      <td>Savannas</td>
      <td>between 10-60% tree cover (&gt;2m).</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>#086a10</td>
      <td>Evergreen Broadleaf Forests</td>
      <td>dominated by evergreen broadleaf and palmate t...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>#78d203</td>
      <td>Deciduous Broadleaf Forests</td>
      <td>dominated by deciduous broadleaf trees (canopy...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>#05450a</td>
      <td>Evergreen Needleleaf Forests</td>
      <td>dominated by evergreen conifer trees (canopy &gt;...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>#54a708</td>
      <td>Deciduous Needleleaf Forests</td>
      <td>dominated by deciduous needleleaf (larch) tree...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>#f9ffa4</td>
      <td>Non-Vegetated Lands</td>
      <td>at least 60% of area is non-vegetated barren (...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10</td>
      <td>#a5a5a5</td>
      <td>Urban and Built-up Lands</td>
      <td>at least 30% impervious surface area including...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>255</td>
      <td>#000000</td>
      <td>Unclassified</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="python"># generate matplotlib cmap and norm objects from these
# as in session 024
import matplotlib
import matplotlib.patches

cmap = matplotlib.colors.\
        ListedColormap(list(lc_Type3['colour']))
norm = matplotlib.colors.\
        BoundaryNorm(list(lc_Type3['code']), len(lc_Type3['code']))

# set up the legend
legend_labels = dict(zip(list(lc_Type3['colour']),list(lc_Type3['class'])))
patches = [matplotlib.patches.Patch(color=c, label=l)
           for c,l in legend_labels.items()]
</code></pre>

<pre><code class="python">import gdal
import numpy as np

# read the LC_Type3 dataset
g = gdal.Open(lcfiles['LC_Type3'])
land_cover = g.ReadAsArray()

# If the unique values dont correspond with
# what we expect for the land cover codes, there 
# has been some error in processing
print(np.unique(land_cover))
print(lcfiles['LC_Type3'])
</code></pre>

<pre><code>[  1   3   4   5   6   7  10 255]
/shared/groups/jrole001/geog0111/work/MCD12Q1/data.LC_Type3._h17v03_h18v03_h17v04_h18v04_.2019.001.001_warp.vrt
</code></pre>
<pre><code class="python"># plot
import matplotlib.pyplot as plt
x_size,y_size=(10,10)
fig, axs = plt.subplots(1,figsize=(x_size,y_size))
im = axs.imshow(land_cover,cmap=cmap,norm=norm,interpolation='nearest')
plt.legend(handles=patches,
          bbox_to_anchor=(1.6, 1),
          facecolor=&quot;white&quot;)
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7fba5d278a90&gt;
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_26_1.png" /></p>
<h4 id="exercise-3">Exercise 3</h4>
<ul>
<li>Write a function <code>get_lc</code> that takes as argument:<pre><code>year    : int
tile    : list of MODIS tiles, list of st
fips    : country FIPS code, str
</code></pre>
</li>
</ul>
<p>and returns a byte array of land cover type LC_Type3 for the year and country specified
* In your function, print out the unique values in the landcover dataset to give some feedback to the user
* Write a function <code>plot_LC_Type3</code> that will plot LC_Type3 data with an appropriate colourmap.
* Produce a plot of the land cover of Belgium for 2018</p>
<p>We can now consider masking both for valid pixels and for a particular land cover type.</p>
<pre><code class="python"># reload the dataset
from geog0111.get_lai_data import get_lai_data
from geog0111.get_weight import get_weight
from geog0111.regularise import regularise

year = 2019
tile = ['h17v03', 'h18v03','h17v04', 'h18v04']
fips = &quot;LU&quot;
lc = get_lc(year,tile,fips)
lc_Type3 = pd.read_csv('data/LC_Type3_colour.csv')
lai,std,doy =  get_lai_data(year,tile,fips)
weight = get_weight(lai,std)
interpolated_lai = regularise(lai,weight,5.0)
</code></pre>

<pre><code>class codes: [  1   3   4   5   6   7  10 255]
</code></pre>
<pre><code class="python"># get the code for Grasslands
# might be easier to look in the table ...
# but we can extract it
classy = 'Grasslands'
code = int(lc_Type3[lc_Type3['class'] == classy]['code'])
print(f'code for {classy} is {code}')
</code></pre>

<pre><code>code for Grasslands is 1
</code></pre>
<pre><code class="python"># code 
code_mask = (land_cover == code)
valid_mask = ~np.isnan(np.sum(interpolated_lai,axis=0))

# combine
mask = np.logical_and(code_mask,valid_mask)
masked_lai = interpolated_lai[:,mask]
print(masked_lai.shape)
</code></pre>

<pre><code>(92, 2661)
</code></pre>
<p>Notice how we used <code>interpolated_lai[:,mask]</code> to apply the mask to the last 2 dimensions of the `interpolated_laia dataset. The result is 2D, the first dimension being the number of time samples.</p>
<p>Now, take the mean, over axis 1:</p>
<pre><code class="python">mean_lai = np.mean(masked_lai,axis=(1))
median_lai = np.median(masked_lai,axis=(1))
max_lai = np.max(masked_lai,axis=(1))
min_lai = np.min(masked_lai,axis=(1))

# check they have the same shape before we plot them!
masked_lai.shape,doy.shape
</code></pre>

<pre><code>((92, 2661), (92,))
</code></pre>
<pre><code class="python"># plot 
x_size,y_size=(10,5)

fig, axs = plt.subplots(1,1,figsize=(x_size,y_size))
x = doy
axs.plot(x,mean_lai,label=f&quot;{classy} mean&quot;)
axs.plot(x,median_lai,label=f&quot;{classy} median&quot;)
axs.plot(x,max_lai,label=f&quot;{classy} max&quot;)
axs.plot(x,min_lai,label=f&quot;{classy} min&quot;)
axs.set_title(f'smoothed LAI LU')
# ensure the same scale for all
axs.set_ylim(0,7)
axs.set_ylabel('LAI')
axs.set_xlabel('DOY 2019')
axs.set_xlim(0,365)
axs.legend(loc='upper right')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0x7fba5ce1cf90&gt;
</code></pre>
<p><img alt="png" src="../043_Weighted_interpolation_files/043_Weighted_interpolation_34_1.png" /></p>
<h2 id="formative-assessment">Formative assessment</h2>
<p>To get some feedback on how you are doing, you should complete and submit the formative assessment <a href="../065_LAI/">065 LAI</a>.</p>
<h2 id="summary">Summary</h2>
<p>From this session, you should be able to acquire a MODIS timeseries dataset and associated land cover map. You should be able to treat the data, so that by defining a weight for weach observation, you can produce a regularised (smoothed, interpolated) dataset from original noisy observations. In this case, we used variable weighting, according to an uncertainty measure, but if that is not available, you can simply use a weight of 1 for a valid observation and 0 when there is no valid value. </p>
<p>You should then be able to calculate statistics from the data. You should be capable of doing this for any MODIS geophysical variable, and also of developing functiuons that bring some of these ideas together into more compact, reusable code.</p>
<p>Remember:</p>
<table>
<thead>
<tr>
<th>function</th>
<th>comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scipy.ndimage.filters</code></td>
<td><code>scipy</code> filters</td>
</tr>
<tr>
<td><code>zscipy.ndimage.filters.convolve1d(data,filter)</code></td>
<td>1D convolution of <code>filter</code> with <code>data</code>. Keywords : <code>axis=0,mode='wrap'</code></td>
</tr>
</tbody>
</table>
<pre><code class="python">from geog0111 import regularise
help(regularise)
</code></pre>

<pre><code>Help on module geog0111.regularise in geog0111:

NAME
    geog0111.regularise

FUNCTIONS
    regularise(lai, weight, sigma)
        takes as argument:

            lai     : MODIS LAI dataset:     shape (Nt,Nx,Ny)
            weight  : MODIS LAI weight:      shape (Nt,Nx,Ny)
            sigma   : Gaussian filter width: float

        returns an array the same shape as 
        lai of regularised LAI. Regularisation takes place along
        axis 0 (the time axis)

FILE
    /nfs/cfs/home3/Uucfa6/ucfalew/geog0111/notebooks/geog0111/regularise.py
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../042_Weighted_smoothing_and_interpolation/" title="Weighted Smoothing And Interpolation" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Weighted Smoothing And Interpolation
              </div>
            </div>
          </a>
        
        
          <a href="../040_GDAL_mosaicing_and_masking_answers/" title="GDAL Mosaicing And Masking" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                GDAL Mosaicing And Masking
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>